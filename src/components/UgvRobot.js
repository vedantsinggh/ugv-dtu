import { useEffect, useRef } from "react";
import "./UgvRobot.css";

export default function UgvRobot() {
  const headRef = useRef(null);
  const eyesRef = useRef(null);

  useEffect(() => {
  const sweat = document.getElementById("sweat");
  const svg = document.querySelector(".ugv-svg");

  const handleMove = (e) => {
    if (!svg || !headRef.current || !eyesRef.current) return;

    const rect = svg.getBoundingClientRect();

    const cx = rect.left + rect.width / 2;
    const cy = rect.top + rect.height / 2;

    const dx = e.clientX - cx;
    const dy = e.clientY - cy;

    const nx = dx / (rect.width );
    const ny = dy / (rect.height );

    const clampedX = Math.max(-1, Math.min(1, nx));
    const clampedY = Math.max(-1, Math.min(1, ny));

    const isFront = dx > 0;

    if (isFront) {
      const headRotate = clampedY * 10 + clampedX * 12;

      headRef.current.style.transform =
        `rotate(${headRotate}deg)`;

      eyesRef.current.style.transform =
        `translate(${clampedX * 6}px, ${clampedY * 4}px)`;

      sweat?.classList.remove("active");
    } else {
      headRef.current.style.transform = "rotate(0deg)";
      eyesRef.current.style.transform = "translate(0, 0)";
      sweat?.classList.add("active");
    }
  };

  window.addEventListener("mousemove", handleMove);
  return () => window.removeEventListener("mousemove", handleMove);
}, []);

  return (
    <div className="ugv-robot">
      <svg
        className="ugv-svg"
        viewBox="1300 0 900 816"
        xmlns="http://www.w3.org/2000/svg"
      >

        <g ref={headRef} id="ugv-head">
            <path
              fill="#ffffff"
              d="m 2054.5027,153.37236 c 29.6641,-7.39877 46.8822,-35.68506 79.5957,-30.96879 26.1064,-13.29506 26.7316,-51.102696 11.5151,-72.026108 -40.6702,-29.338933 -92.0794,-3.051607 -135.6959,5.517102 -27.9358,1.383121 -95.0697,30.997634 -39.7014,49.657616 30.7931,-0.41171 42.3436,8.92739 44.2369,39.35022 8.9261,14.66494 26.2579,10.02562 40.0496,8.46996 z"
            />
          <g ref={eyesRef} id="ugv-eyes"className="ugv-eyes">
            <path
              fill="#8b8b8b"
              d="m 2129.6292,98.697641 c -22.3037,-18.648048 15.6132,-59.830157 14.4952,-18.424779 -0.1791,6.423678 -3.6043,24.965618 -14.4952,18.424779 z"
            />
            <path
              fill="#8b8b8b"
              d="m 2087.5917,99.600221 c -34.4499,-20.942928 13.5793,-72.338618 15.5011,-22.761749 0.9364,9.080038 -1.6364,28.774188 -15.5011,22.761749 z"
            />
          </g>

  <g id="sweat" className="ugv-sweat" transform="translate(0,0)">
    <path
      d="M2025 70
    C1975 170, 2075 170, 2025 70
    Z
      "
      fill="#5ac8fa"
    />
  </g>

        </g>

        <g>
          <path
            fill="#ffffff"
            d="m 1922.4124,163.25877 c 24.2942,-1.61939 82.3473,3.47837 36.0026,-22.73683 -56.2954,-45.485299 -125.5499,-70.734315 -197.1241,-78.34159 -93.1869,-13.057328 -189.2167,-2.531449 -278.8785,24.977512 28.2069,38.761338 81.4028,44.404218 124.9101,55.724778 103.61,20.36357 209.8286,23.15185 315.0899,20.37613 z"
          />
          <path
            fill="#ffffff"
            d="m 2060.3301,560.67418 c 41.1021,-75.97175 37.3844,-168.65903 14.4905,-249.98168 -14.5656,-35.60292 -28.9783,-96.68308 -64.9738,-108.65395 -28.3391,9.35862 -76.1965,9.45387 -96.468,16.23664 91.7451,57.62008 139.9083,169.39163 133.205,275.73318 6.0804,16.49494 -11.9763,70.90864 13.7463,66.66581 z"
          />
          <path
            fill="#ffffff"
            d="m 1417.2999,560.41638 c 9.7739,-58.94901 -2.7445,-121.91073 18.7644,-179.61697 28.2547,-98.68748 110.0849,-179.51545 210.7451,-202.30296 -39.5384,-16.37008 -79.6208,-32.29525 -116.4734,-54.45719 -124.0019,84.1538 -186.7529,249.87465 -141.5682,393.9915 5.7246,12.61344 8.541,51.34964 28.5321,42.38562 z"
          />
        </g>

        <g>
          <path
            fill="#ffffff"
            d="m 1914.8455,608.87715 c 22.2746,-45.24789 -63.4495,-34.34082 -89.6491,-50.25543 -63.7242,-14.63628 -126.4348,-35.00411 -190.8514,-45.76121 -53.4072,0.46269 -23.7614,68.70232 18.5949,57.8208 84.2991,13.2498 168.3287,29.23491 252.7448,41.09299 l 5.2295,-0.90892 z"
          />
          <path
            fill="#ffffff"
            d="m 1950.0085,713.40534 c 77.8634,-15.02511 120.0787,-111.11264 83.4246,-179.77051 -32.3074,-70.00446 -133.0017,-92.09485 -190.4872,-39.77679 -38.9988,21.75308 -22.7328,52.27216 16.4912,52.65781 37.2283,13.06508 122.8588,17.52766 89.5339,77.11426 -38.0603,22.3145 -88.2325,-6.84326 -131.2269,-4.10666 -32.9048,13.13614 16.3702,62.91382 36.5767,76.39246 27.8995,19.13273 62.8745,24.11053 95.6877,17.48943 z"
          />
          <path
            fill="#ffffff"
            d="m 1636.7774,715.16803 c 55.2955,-8.64964 107.6213,-42.90919 133.5304,-92.94292 -26.8326,-25.36942 -83.8197,-14.91397 -122.1239,-25.97043 -45.1845,-8.43845 -119.481,0.0815 -122.624,-63.94413 -6.5908,-68.81186 70.1674,-73.80378 115.3203,-48.76649 50.0587,12.8387 99.0457,32.11204 149.899,40.39619 15.6927,-51.27823 -22.5808,-112.49162 -61.8033,-147.44281 -74.4,-66.95701 -201.2471,-54.72569 -261.5834,25.03062 -68.7444,80.34886 -53.9728,214.61305 31.6182,277.19281 38.6579,30.28467 89.2333,43.36797 137.7667,36.44716 z"
          />
        </g>

        <g>
          <path
            fill="#ffffff"
            d="m 1711.4124,775.251 c 102.463,-6.70275 205.1203,-18.29948 305.2101,-41.62999 29.7354,-16.97169 -95.8371,5.65987 -61.5974,-1.23624 -153.442,14.0465 -310.0165,20.30722 -462.1148,-8.82369 -31.3154,1.67783 -93.1169,-41.46382 -104.3769,-28.73137 36.7538,58.7142 108.2479,74.96048 172.6419,79.4599 49.9184,4.34994 100.2206,2.29036 150.2371,0.96139 z"
          />
        </g>
      </svg>
    </div>
  );
}